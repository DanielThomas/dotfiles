#!/usr/bin/env bash

project_dir="$1"
if [ -z "$project_dir" ]; then
	project_dir=$(pwd)
fi

if [ ! -z "$CODER_WORKSPACE_NAME" ]; then
	# see dev/fleet.zsh
	fleet_cache=/home/coder/.cache/JetBrains/Fleet
	fleet_dock_address="$fleet_cache/dock.address"
	fleet_workspace="$fleet_cache/workspace-params"
	if [[ -f "$fleet_dock_address" && -f "$fleet_workspace" ]]; then
		open "jetbrains://fleet/join?$(head -1 $fleet_workspace)"	
	else
		"Fleet workspace is not running"
	fi
else
	default_launcher=$(which -a fleet | grep -v "$0" | head -1)
	if [ ! -z "$default_launcher" ]; then
		$default_launcher $project_dir
	else
		echo "Could not find default Fleet launcher"
		exit 1
	fi
fi
